!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.Tournament=t()}}(function(){return function t(n,r,e){function i(u,s){if(!r[u]){if(!n[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[u]={exports:{}};n[u][0].call(c.exports,function(t){var r=n[u][1][t];return i(r?r:t)},c,c.exports,t,n,r,e)}return r[u].exports}for(var o="function"==typeof require&&require,u=0;u<e.length;u++)i(e[u]);return i}({1:[function(t,n,r){var e=Array.prototype.slice,i=function(){var t=arguments;return function(){for(var n=t[0].apply(this,arguments),r=1,e=t.length;e>r;r+=1)n=t[r](n);return n}},o=i;o.seq=i,o.id=function(t){return t},o.noop=function(){},o.copy=function(t){return Array.isArray(t)?t.slice():t===Object(t)?o.extend({},t):t},o.constant=function(t){return function(){return o.copy(t)}},o.not=function(t){return function(n){return!t(n)}},o.all=function(t){return function(n){return n.every(t)}},o.any=function(t){return function(n){return n.some(t)}},o.none=function(t){return function(n){return!n.some(t)}},o.elem=function(t){return function(n){return t.indexOf(n)>=0}},o.notElem=function(t){return function(n){return t.indexOf(n)<0}},o.extend=function(t,n){for(var r=Object.keys(n),e=0;e<r.length;e+=1){var i=r[e];t[i]=n[i]}return t},o.gcd=function(t,n){for(t=Math.abs(t),n=Math.abs(n);n;){var r=n;n=t%n,t=r}return t},o.lcm=function(t,n){return t&&n?Math.abs(t*n/o.gcd(t,n)):0},o.even=function(t){return t%2===0},o.odd=function(t){return t%2===1},o.get=function(){var t=arguments;return function(n){for(var r=n,e=0;e<t.length&&void 0!==r;e+=1)r=r[t[e]];return r}},o.pluck=function(t,n){for(var r=[],e=0,i=n.length;i>e;e+=1)r[e]=n[e][t];return r},o.first=function(t){return t[0]},o.last=function(t){return t[t.length-1]},o.firstBy=function(t,n){for(var r=0,e=n.length;e>r;r+=1)if(t(n[r]))return n[r]},o.lastBy=function(t,n){for(var r=n.length-1;r>=0;r-=1)if(t(n[r]))return n[r]},o.range=function(t,n,r){arguments.length<=1&&(n=t,t=1),r=arguments[2]||1;for(var e=Math.max(Math.ceil((n-t+1)/r),0),i=new Array(e),o=0;e>o;o+=1,t+=r)i[o]=t;return i},o.replicate=function(t,n){for(var r=[],e=0;t>e;e+=1)r.push(o.copy(n));return r},o.zipWith=function(){for(var t=arguments[0],n=e.call(arguments,1),r=n.length,i=[],u=Math.min.apply(Math,o.pluck("length",n)),s=0;u>s;s+=1){for(var a=[],f=0;r>f;f+=1)a.push(n[f][s]);i.push(t.apply(this,a))}return i},o.zip=function(){for(var t=arguments.length,n=[],r=Math.min.apply(Math,o.pluck("length",arguments)),e=0;r>e;e+=1){for(var i=[],u=0;t>u;u+=1)i.push(arguments[u][e]);n.push(i)}return n},o.iterate=function(t,n,r){for(var e=[n],i=1;t>i;i+=1)e.push(r(e[i-1]));return e},o.scan=function(t,n,r){for(var e=[n],i=0,o=t.length;o>i;i+=1)e.push(r(e[i],t[i]));return e},o.reduce=function(t,n){return function(r){return r.reduce(t,n)}},o.map=function(t){return function(n){return n.map(t)}},o.filter=function(t){return function(n){return n.filter(t)}},o.invoke=function(t){var n=e.call(arguments,1);return function(r){var e=r[t];return e.apply(r,n)}},n.exports=o},{}],2:[function(t,n,r){var e=function(t,n){var r=Math.ceil(t/n);n=e.minimalGroupSize(t,n,r);for(var i=r*n,o=[],u=0;r>u;u+=1)o[u]=[];for(var s=0;s<Math.ceil(n/2);s+=1)for(var a=0;r>a;a+=1){var f=s*r+a+1;o[a].push(f),o[a].length<n&&o[a].push(i+1-f)}return o.map(function(n){return n.sort(function(t,n){return t-n}).filter(function(n){return t>=n})})};e.fromArray=function(t,n){return e(t.length,n).map(function(n){return n.map(function(n){return t[n-1]})})},e.minimalGroupSize=function(t,n){for(var r=arguments[2]||Math.ceil(t/n);r*n-t>=r;)n-=1;return n},n.exports=e},{}],3:[function(t,n,r){var e=t("autonomy");n.exports=function(){var t=arguments;return function(){for(var n=t[0].apply(this,arguments),r=1,e=t.length;e>r;r+=1)n=t[r](n);return n}},e.extend(n.exports,e),e.extend(n.exports,t("operators")),e.extend(n.exports,t("subset"))},{autonomy:1,operators:4,subset:6}],4:[function(t,n,r){var e={},i=Array.prototype.concat;e.plus2=function(t,n){return t+n},e.plus3=function(t,n,r){return t+n+r},e.plus4=function(t,n,r,e){return t+n+r+e},e.times2=function(t,n){return t*n},e.times3=function(t,n,r){return t*n*r},e.times4=function(t,n,r,e){return t*n*r*e},e.and2=function(t,n){return t&&n},e.and3=function(t,n,r){return t&&n&&r},e.and4=function(t,n,r,e){return t&&n&&r&&e},e.or2=function(t,n){return t||n},e.or3=function(t,n,r){return t||n||r},e.or4=function(t,n,r,e){return t||n||r||e},e.append2=function(t,n){return t.concat(n)},e.append3=function(t,n,r){return t.concat(n,r)},e.append4=function(t,n,r,e){return t.concat(n,r,e)},e.prepend2=function(t,n){return n.concat(t)},e.sum=function(t){for(var n=0,r=0;r<t.length;r+=1)n+=t[r];return n},e.product=function(t){for(var n=1,r=0,e=t.length;e>r;r+=1)n*=t[r];return n},e.and=function(t){for(var n=!0,r=0,e=t.length;e>r;r+=1)n=n&&t[r];return n},e.or=function(t){for(var n=!1,r=0,e=t.length;e>r;r+=1)n=n||t[r];return n},e.flatten=function(t){return i.apply([],t)},e.add=function(){for(var t=0,n=0,r=arguments.length;r>n;n+=1)t+=arguments[n];return t},e.multiply=function(){for(var t=1,n=0,r=arguments.length;r>n;n+=1)t*=arguments[n];return t},e.concat=function(){return i.apply([],arguments)},e.minus2=function(t,n){return t-n},e.divide2=function(t,n){return t/n},e.div2=function(t,n){return Math.floor(t/n)},e.mod2=function(t,n){return t%n},e.pow2=Math.pow,e.log2=function(t,n){return Math.log(t)/Math.log(n)},e.eq2=function(t,n){return t===n},e.neq2=function(t,n){return t!==n},e.gt2=function(t,n){return t>n},e.lt2=function(t,n){return n>t},e.gte2=function(t,n){return t>=n},e.lte2=function(t,n){return n>=t},e.plus=function(t){return function(n){return n+t}},e.minus=function(t){return function(n){return n-t}},e.times=function(t){return function(n){return n*t}},e.divide=function(t){return function(n){return n/t}},e.div=function(t){return function(n){return Math.floor(n/t)}},e.mod=function(t){return function(n){return n%t}},e.pow=function(t){return function(n){return Math.pow(n,t)}},e.log=function(t){return function(n){return Math.log(n)/Math.log(t)}},e.append=function(t){return function(n){return n.concat(t)}},e.prepend=function(t){return function(n){return t.concat(n)}},e.gt=function(t){return function(n){return n>t}},e.lt=function(t){return function(n){return t>n}},e.eq=function(t){return function(n){return n===t}},e.neq=function(t){return function(n){return n!==t}},e.gte=function(t){return function(n){return n>=t}},e.lte=function(t){return function(n){return t>=n}},n.exports=e},{}],5:[function(t,n,r){const e=-1;n.exports=function(t,n){var r=[];if(n)n=n.slice();else{n=[];for(var i=1;t>=i;i+=1)n.push(i)}t%2===1&&(n.push(e),t+=1);for(var o=0;t-1>o;o+=1){r[o]=[];for(var u=0;t/2>u;u+=1)n[u]!==e&&n[t-1-u]!==e&&r[o].push([n[u],n[t-1-u]]);n.splice(1,0,n.pop())}return r}},{}],6:[function(t,n,r){var e={};e.equality=function(){var t=arguments;return function(n,r){for(var e=0,i=t.length;i>e;e+=1)if(n[t[e]]!==r[t[e]])return!1;return!0}},e.compare=function(t,n){return"function"==typeof t?(n=n||1,function(r,e){return n*(t(r)-t(e))}):(t=t||1,function(n,r){return t*(n-r)})},e.comparing=function(){var t=arguments;return function(n,r){for(var e=0,i=t.length;i>e;e+=2){var o=t[e+1]||1;if(n[t[e]]!==r[t[e]])return o*(n[t[e]]-r[t[e]])}return 0}};var i=function(t,n){return t===n};e.maximum=function(t){return Math.max.apply(Math,t)},e.minimum=function(t){return Math.min.apply(Math,t)},e.maximumBy=function(t,n){for(var r=1,e=n[0],i=n.length;i>r;r+=1)t(n[r],e)>0&&(e=n[r]);return e},e.minimumBy=function(t,n){for(var r=1,e=n[0],i=n.length;i>r;r+=1)t(n[r],e)<0&&(e=n[r]);return e},e.insertBy=function(t,n,r){for(var e=0,i=n.length;i>e;e+=1)if(t(n[e],r)>=0)return n.splice(e,0,r),n;return n.push(r),n},e.insert=function(t,n){return e.insertBy(e.compare(),t,n)},e.deleteBy=function(t,n,r){for(var e=0,i=n.length;i>e;e+=1)if(t(n[e],r))return n.splice(e,1),n;return n},e["delete"]=function(t,n){var r=t.indexOf(n);return r>=0&&t.splice(r,1),t},e.intersectBy=function(t,n,r){var e=[],i=n.length,o=r.length;if(i&&o)for(var u=0;i>u;u+=1)for(var s=n[u],a=0;o>a;a+=1)if(t(s,r[a])){e.push(s);break}return e},e.intersect=function(t,n){return e.intersectBy(i,t,n)},e.nubBy=function(t,n){for(var r=[],e=0,i=n.length;i>e;e+=1){for(var o=!0,u=0,s=r.length;s>u;u+=1)if(t(r[u],n[e])){o=!1;break}o&&r.push(n[e])}return r},e.nub=function(t){for(var n=[],r=0,e=t.length;e>r;r+=1)n.indexOf(t[r])<0&&n.push(t[r]);return n},e.groupBy=function(t,n){for(var r,e,i=[],o=0,u=n.length;u>o;o=r){for(e=[n[o]],r=o+1;u>r&&t(n[o],n[r]);r+=1)e.push(n[r]);i.push(e)}return i},e.group=function(t){return e.groupBy(i,t)},e.unionBy=function(t,n,r){return n.concat(n.reduce(e.deleteBy.bind(null,t),e.nubBy(t,r)))},e.union=function(t,n){return t.concat(t.reduce(e["delete"],e.nub(n)))},e.differenceBy=function(t,n,r){return r.reduce(e.deleteBy.bind(null,t),n.slice())},e.difference=function(t,n){return n.reduce(e["delete"],t.slice())},e.isSubsetOf=function(t,n,r){for(var e=n.slice(),i=0;i<t.length;i+=1){var o=t[i],u=e.indexOf(o);if(0>u)return!1;e.splice(u,1)}return r?e.length>0:!0},n.exports=e},{}],7:[function(t,n,r){var e=t("interlude"),i={NONE:0};i.findMatch=function(t,n){return e.firstBy(function(t){return n.s===t.id.s&&n.r===t.id.r&&n.m===t.id.m},t)},i.findMatches=function(t,n){return t.filter(function(t){return!(null!=n.s&&t.id.s!==n.s||null!=n.r&&t.id.r!==n.r||null!=n.m&&t.id.m!==n.m)})},i.findMatchesRanged=function(t,n,r){return r=r||{},t.filter(function(t){return(null==n.s||t.id.s>=n.s)&&(null==n.r||t.id.r>=n.r)&&(null==n.m||t.id.m>=n.m)&&(null==r.s||t.id.s<=r.s)&&(null==r.r||t.id.r<=r.r)&&(null==r.m||t.id.m<=r.m)})},i.partitionMatches=function(t,n,r,e){for(var i=[],o=0;o<t.length;o+=1){var u=t[o];null!=e&&u.id[r]!==e||(Array.isArray(i[u.id[n]-1])||(i[u.id[n]-1]=[]),i[u.id[n]-1].push(u))}return i},i.matchesForPlayer=function(t,n){return t.filter(function(t){return t.p.indexOf(n)>=0})},i.players=function(t){var n=t.reduce(function(t,n){return t.concat(n.p)},[]);return e.nub(n).filter(e.gt(i.NONE)).sort(e.compare())},i.rounds=function(t){return e.nub(t.map(e.get("id","r"))).sort(e.compare())},i.upcoming=function(t,n){return t.filter(function(t){return t.p.indexOf(n)>=0&&!t.m})},i.started=function(t){return t.some(function(t){return t.p.every(e.gt(i.NONE))&&t.m})},i.playable=function(t){return!t.p.some(e.eq(i.NONE))},n.exports=i},{interlude:3}],8:[function(t,n,r){function e(t,n){this.matches=n,this.state=[]}var i=t("interlude"),o=t("./match");Object.defineProperty(e,"NONE",{enumerable:!0,value:o.NONE}),Object.defineProperty(e,"helpers",{value:o});var u=function(t,n){if(o.started(t.matches))throw new Error("Cannot replace players for a tournament in progress");t.matches.forEach(function(t){t.p=t.p.map(function(t){return t>0?n[t-1].seed:t})})};e.from=function(t,n,r,e){var i="Cannot forward from "+n.name+": ";if(!n.isDone())throw new Error(i+"tournament not done");var o=n.results();if(o.length<r)throw new Error(i+"not enough players");var s=o.filter(function(t){return t.pos<=r});if(s.length>r)throw new Error(i+"too many players tied to pick out top "+r);var a=new t(r,e);return u(a,o),a},e.resultEntry=function(t,n){for(var r=0;r<t.length;r+=1)if(t[r].seed===n)return t[r];throw new Error("No result found for seed "+n+" in result array:"+t)};var s=function(t){return t+""=="[object Object]"?"S"+t.s+" R"+t.r+" M"+t.m:t+""};e.isInteger=function(t){return Math.ceil(t)===t},e.sub=function(t,n,r){var i=r||e,o=function(r,e){if(!(this instanceof o))return new o(r,e);if(!o.invalid)throw new Error(t+" must implement an Invalid function");Object.defineProperty(this,"_opts",{configurable:!0,value:(o.defaults?o:i).defaults(r,e)});var u=o.invalid(r,this._opts);if(null!==u)throw this._opts.log.error("Invalid %d player %s with opts=%j rejected",r,t,this._opts),new Error("Cannot construct "+t+": "+u);this.numPlayers=r,this.name=t,n.call(this,this._opts,i.bind(this,r))};return i.inherit(o,i),o},e.invalid=i.constant(null),e.defaults=function(t,n){var r=i.extend({},n||{});return r.log=n&&n.log?n.log:console,r},e.configure=function(t,n,r){var i=r||e;n.defaults?t.defaults=function(t,r){return n.defaults(t,i.defaults(t,r))}:t.defaults=i.defaults,n.invalid?t.invalid=function(r,i){if(!e.isInteger(r))return"numPlayers must be a finite integer";var o=n.invalid(r,t.defaults(r,i));return null!==o?o:null}:t.invalid=i.invalid},e.inherit=function(t,n){var r=n||e;t.prototype=Object.create(r.prototype);var o={_verify:null,_progress:void 0,_early:!1,_safe:!1,_initResult:{}};Object.keys(o).forEach(function(n){t.prototype[n]=r.prototype[n]||i.constant(o[n])}),t.from=function(n,r,i){return e.from(t,n,r,i)},t.restore=function(n,r,e){var i=new t(n,r);return e.forEach(function(t){"score"===t.type&&i.score(t.id,t.score)}),i},t.configure=function(n){return e.configure(t,n,r)},t.sub=function(n,e){return r.sub(n,e,t)},t.inherit=function(n){return r.inherit(n,t)}},e.compareMatches=function(t,n){return t.id.s-n.id.s||t.id.r-n.id.r||t.id.m-n.id.m},e.compareRes=function(t,n){return t.pos-n.pos||t.seed-n.seed},e.compareZip=function(t,n){return n[1]-t[1]||t[0]-n[0]},e.sorted=function(t){return i.zip(t.p,t.m).sort(e.compareZip).map(i.get("0"))},e.resTieCompute=function(t,n,r,e){for(var i=n,o=0,u=-(1/0),s=0;s<t.length;s+=1){var a=t[s],f=e(a);f===u?o+=1:(i+=o+1,o=0),u=f,r(a,i)}},e.matchTieCompute=function(t,n,r){for(var e=n,i=0,o=-(1/0),u=0;u<t.length;u+=1){var s=t[u],a=s[0],f=s[1];o===f?i+=1:(e+=1+i,i=0),o=f,r(a,e)}},e.prototype.isDone=function(){return this.matches.every(i.get("m"))||this._early()},e.prototype.unscorable=function(t,n,r){var e=this.findMatch(t);return e?this.isPlayable(e)?Array.isArray(n)&&n.every(Number.isFinite)?n.length!==e.p.length?s(t)+" scores must have length "+e.p.length:r||!Array.isArray(e.m)||this._safe(e)?this._verify(e,n):s(t)+" cannot be re-scored":s(t)+" scores must be a numeric array":s(t)+" not ready - missing players":s(t)+" not found in tournament"},e.prototype.score=function(t,n){var r=this.unscorable(t,n,!0);if(null!==r)return this._opts.log.error("failed scoring match %s with %j",s(t),n),this._opts.log.error("reason:",r),!1;var e=this.findMatch(t);return e.m=n,this.state.push({type:"score",id:t,score:n}),this._progress(e),!0},e.prototype.results=function(){var t=this.players();if(this.numPlayers!==t.length){var n=t.length+" !== "+this.numPlayers;throw new Error(this.name+" initialized numPlayers incorrectly: "+n)}for(var r=new Array(this.numPlayers),o=0;o<this.numPlayers;o+=1)r[o]={seed:t[o],wins:0,"for":0,against:0,pos:this.numPlayers},i.extend(r[o],this._initResult(t[o]));return this._stats instanceof Function&&this.matches.reduce(this._stats.bind(this),r),this._sort instanceof Function?this._sort(r):r.sort(e.compareRes)},e.prototype.resultsFor=function(t){return i.firstBy(function(n){return n.seed===t},this.results())},e.prototype.upcoming=function(t){return o.upcoming(this.matches,t)},e.prototype.isPlayable=o.playable,e.prototype.findMatch=function(t){return o.findMatch(this.matches,t)},e.prototype.findMatches=function(t){return o.findMatches(this.matches,t)},e.prototype.findMatchesRanged=function(t,n){return o.findMatchesRanged(this.matches,t,n)},e.prototype.rounds=function(t){return o.partitionMatches(this.matches,"r","s",t)},e.prototype.sections=function(t){return o.partitionMatches(this.matches,"s","r",t)};var a=function(t){return t.some(function(t){return!t.m})};e.prototype.currentRound=function(t){return i.firstBy(a,this.rounds(t))},e.prototype.nextRound=function(t){for(var n=this.rounds(t),r=0;r<n.length;r+=1)if(a(n[r]))return n[r+1]},e.prototype.matchesFor=function(t){return o.matchesForPlayer(this.matches,t)},e.prototype.players=function(t){return o.players(this.findMatches(t||{}))},n.exports=e},{"./match":7,interlude:3}],duel:[function(t,n,r){function e(t,n,r){return this instanceof e?(this.s=t,this.r=n,void(this.m=r)):new e(t,n,r)}var i=t("tournament"),o=t("interlude");const u=1,s=2,a=-1;e.prototype.toString=function(){return(this.s===u?"WB":"LB")+" R"+this.r+" M"+this.m};var f=function(){return[i.NONE,i.NONE]},c=function(t,n){return t.map(function(t){return t>n?a:t})},h=function(t,n,r){return new e(t,n,r)},l=function(t,n){var r=Math.floor(Math.log(t)/Math.log(2)),e=t-Math.pow(2,r);if(0===e)return Math.pow(2,n-r);var i=(t-2*e).toString(2).split("").reverse().join("");return(parseInt(i,2)<<n-i.length)+Math.pow(2,n-r-1)},p=function(t,n){var r=l(t,n);return[Math.pow(2,n)+1-r,r]},d=function(t,n,r,e){for(var o=[],a=1;a<=Math.pow(2,n-1);a+=1)o.push({id:h(u,1,a),p:c(p(a,n),t)});var l,d;for(l=2;n>=l;l+=1)for(d=1;d<=Math.pow(2,n-l);d+=1)o.push({id:h(u,l,d),p:f()});if(r>=s){for(l=1;2*n-2>=l;l+=1)for(d=1;d<=Math.pow(2,n-1-Math.floor((l+1)/2));d+=1)o.push({id:h(s,l,d),p:f()});o.push({id:h(s,2*n-1,1),p:f()})}return e&&o.push({id:h(s,r===s?2*n:1,1),p:f()}),o.sort(i.compareMatches)},m=function(t){var n=t.s,r=t.r,e=t.m,i=this.p,a=this.last===u&&r===i,f=this.last===s&&n===s&&r===2*i,c=this.last===u&&n===s,l=n===s&&r===2*i-1&&!this.isLong;if(a||f||c||l)return null;if(this.last>=s&&n===u&&r===i)return[h(s,2*i-1,1),0];var p,d=n===s&&o.odd(r)?e:Math.floor((e+1)/2);return p=n===u?(e+1)%2:r>=2*i-2?(r+1)%2:1===r?this.downMix?1:e%2:o.odd(r)?1:(e+1)%2,[h(n,r+1,d),p]},v=function(t,n,r){var e=Math.pow(2,t-n),i=Math.floor(Math.pow(2,t-n-1)),u=o.odd(Math.floor(n/2)),s=o.even(Math.floor((n+1)/2));return s?u?r>i?e-r+i+1:i-r+1:r>i?r-i:r+i:u?e-r+1:r},g=function(t){var n=t.s,r=t.r,e=t.m,i=this.p;if(n>=this.last)return n===u&&this.isLong&&r===i-1?[h(s,1,1),(e+1)%2]:n===s&&r===2*i-1&&this.isLong?[h(s,2*i,1),1]:null;if(1===r)return[h(s,1,Math.floor((e+1)/2)),e%2];if(this.downMix)return[h(s,2*(r-1),v(i,r,e)),0];var a=r>2||o.odd(e)?0:1;return[h(s,2*(r-1),e),a]},y=function(t,n){if(t){var r=t[0],e=t[1],i=this.findMatch(r);if(!i)throw new Error("tournament corrupt: "+r+" not found!");if(i.p[e]=n,i.p[(e+1)%2]===a)return i.m=e?[0,1]:[1,0],i.id}},w=function(t,n){var r=n.p.indexOf(a);r>=0&&(n.m=0===r?[0,1]:[1,0],t(n))},b=function(t,n){var r=2*t-n,e=Math.floor(r/2)-1;if(0>e)throw new Error("lbPos model works for k>=0 only");var i=Math.pow(2,e)*(r%2);return Math.pow(2,e+1)+1+i},M=function(t,n){return Math.pow(2,t-n)+1},E=function(t,n,r){return t===s?b(n,r):M(n,r)},x=i.sub("Duel",function(t,n){this.isLong=t.isLong,this.last=t.last,this.limit=t.limit,this.downMix=t.downMix,this.p=Math.ceil(Math.log(this.numPlayers)/Math.log(2)),n(d(this.numPlayers,this.p,this.last,this.isLong));var r=w.bind(null,this._progress.bind(this));this.findMatches({s:u,r:1}).forEach(r),this.last>u&&this.findMatches({s:s,r:1}).forEach(r)});x.configure({defaults:function(t,n){return n.isLong=!n["short"],n.last=n.last||u,n.limit=0|n.limit,n.downMix=Boolean(n.downMix&&n.last>u),n},invalid:function(t,n){return 4>t||t>1024?"numPlayers must be >= 4 and <= 1024":[u,s].indexOf(n.last)<0?"last elimination bracket must be either WB or LB":n.limit?"limits not yet supported":null}});var P={WB:u,LB:s,WO:a};Object.keys(P).forEach(function(t){Object.defineProperty(x,t,{enumerable:!0,value:P[t]})}),x.attachNames=function(t){x.prototype.roundName=function(n){return t(P,this.last,this.p,n)}},x.prototype._progress=function(t){var n=y.bind(this),r=t.m[0]>t.m[1]?t.p[0]:t.p[1],e=t.m[0]>t.m[1]?t.p[1]:t.p[0],i=t.id.s===s&&t.id.r===2*this.p-1&&this.isLong;i&&r===t.p[0]&&(r=e=0),n(this.right(t.id),r);var o=n(this.down(t.id),e);o&&n(this.right(o),e)},x.prototype._verify=function(t,n){return t.p[0]===a||t.p[1]===a?"cannot override score in walkover'd match":n[0]===n[1]?"cannot draw a duel":null},x.prototype._safe=function(t){var n=this.right(t.id),r=this.down(t.id),e=n&&this.findMatch(n[0]),i=r&&this.findMatch(r[0]),o=i&&this.right(i.id),u=o&&this.findMatch(o[0]);return[e,i,u].every(function(t){return!t||!t.m||t.p[0]===a||t.p[1]===a})},x.prototype._early=function(){var t=this.matches[this.matches.length-2];return this.isLong&&this.last===s&&t.m&&t.m[0]>t.m[1]},x.prototype._stats=function(t,n){var r=this.isLong,e=this.last,f=this.p,c=r&&e===u&&n.id.s===s,h=e===u&&n.id.s===u&&n.id.r===f,l=e===s&&n.id.s===s&&n.id.r>=2*f-1,p=r&&e===u&&n.id.s===u&&n.id.r===f-1,d=!(c||h||l||p),m=n.id.s<e?this.down(n.id,!1)[0].r:n.id.r;if(n.p.filter(o.gt(0)).forEach(function(n){i.resultEntry(t,n).pos=d?E(e,f,m):2+2*Number(c||p)}),n.p.indexOf(a)<0&&n.m){var v=i.resultEntry(t,n.p[0]),g=i.resultEntry(t,n.p[1]),y=n.m[0]>n.m[1]?v:g;y.wins+=1,v["for"]+=n.m[0],g["for"]+=n.m[1],v.against+=n.m[1],g.against+=n.m[0];var w=v.seed===y.seed,b=l&&(n.id.r===2*f||!r||w);(c||h||b)&&(y.pos-=1)}return t},x.prototype.down=g,x.prototype.right=m,x.Id=e,n.exports=x},{interlude:3,tournament:8}],ffa:[function(t,n,r){function e(t,n){this.s=1,this.r=t,this.m=n}var i=t("interlude"),o=t("group"),u=t("tournament");e.prototype.toString=function(){return"R"+this.r+" M"+this.m};var s=function(t,n){return new e(t,n)},a=function(t){return t.map(function(t){return i.replicate(t.length,u.NONE)})},f=function(t,n,r){for(var e=[],i=0;i<n.length;i+=1){var u=r[i],f=n[i],c=Math.ceil(t/f),h=o(t,f);if(c!==h.length)throw new Error("internal FFA construction error");i>0&&(h=a(h));for(var l=0;l<h.length;l+=1)e.push({id:s(i+1,l+1),p:h[l]});t=c*u}return e},c=function(t,n,r){var e=t.map(function(t){return i.zip(t.p,t.m).sort(u.compareZip).slice(0,r)});e=i.pluck(0,i.flatten(e).sort(u.compareZip));var s=i.maximum(i.pluck("length",i.pluck("p",n)));o(e.length,s).forEach(function(t,r){n[r].p=t.map(function(t){return e[t-1]})})},h=function(t,n,r,e){if(2>t)return"needs at least 2 players";if(2>n)return"group size must be at least 2";if(r>=n)return"must advance less than the group size";var i=t%e>0;return i&&r>=n-1?"must advance less than the smallest match size":0>=r?"must eliminate players each match":null},l=function(t,n,r){if(2>t)return"must contain at least 2 players";var e=Math.ceil(t/r);if(n>0){if(n>=t)return"limit must be less than the remaining number of players";if(n%e!==0)return"number of matches must divide limit"}return null},p=function(t,n,r,e){if(2>t)return"number of players must be at least 2";if(!n.length||!n.every(u.isInteger))return"sizes must be a non-empty array of integers";if(!r.every(u.isInteger)||n.length!==r.length+1)return"advancers must be a sizes.length-1 length array of integers";for(var i=0,s=0;s<r.length;s+=1){var a=r[s],f=n[s];i=Math.ceil(t/f);var c=o.minimalGroupSize(t,f),p=h(t,c,a,i);if(null!==p)return"round "+(s+1)+" "+p;t=i*a}var d=l(t,e,n[n.length-1]);return null!==d?"final round "+d:null},d=u.sub("FFA",function(t,n){this.limit=t.limit,this.advs=t.advancers,this.sizes=t.sizes,n(f(this.numPlayers,this.sizes,this.advs))});d.configure({defaults:function(t,n){return n.limit=0|n.limit,n.sizes=Array.isArray(n.sizes)?n.sizes:[t],n.advancers=Array.isArray(n.advancers)?n.advancers:[],n},invalid:function(t,n){return p(t,n.sizes,n.advancers,n.limit)}}),d.prototype.limbo=function(t){var n=i.firstBy(function(n){return n.p.indexOf(t)>=0&&n.m},this.currentRound()||[]);if(n){var r=this.advs[n.id.r-1];if(u.sorted(n).slice(0,r).indexOf(t)>=0)return{s:1,r:n.id.r+1}}},d.prototype._progress=function(t){var n=this.advs[t.id.r-1]||0,r=this.findMatches({r:t.id.r});r.every(i.get("m"))&&n>0&&c(r,this.findMatches({r:t.id.r+1}),n)},d.prototype._safe=function(t){var n=this.findMatches({r:t.id.r+1});return n.every(function(t){return!Array.isArray(t.m)})},d.prototype._verify=function(t,n){var r=this.advs[t.id.r-1]||0;if(r>0&&n[r]===n[r-1])return"scores must unambiguous decide who advances";if(!r&&this.limit>0){var e=this.matches[this.matches.length-1].id.m,i=this.limit/e;if(n[i]===n[i-1])return"scores must decide who advances in final round with limits"}return null},d.prototype._stats=function(t,n){if(n.m){var r=this.advs[n.id.r-1]||0;i.zip(n.p,n.m).sort(u.compareZip).forEach(function(n,e,i){var o=u.resultEntry(t,n[0]);o["for"]+=n[1],o.against+=i[0][1]-n[1],r>e&&(o.wins+=1)})}return t};var m=function(t,n){return t.pos-n.pos||n["for"]-n.against-(t["for"]-t.against)||t.seed-n.seed};d.prototype._sort=function(t){var n=this.limit,r=this.advs,e=this.sizes,o=this.sizes.length;return this.rounds().forEach(function(s,a){var f=i.flatten(i.pluck("p",s)).filter(i.gt(u.NONE));f.forEach(function(n){u.resultEntry(t,n).pos=f.length});var c=a===o-1,h=r[a]||0,l=n>0&&c?n/s.length:h,p=i.replicate(e[a]-h,[]);s.filter(i.get("m")).forEach(function(n){var r=c?0:h,e=i.zip(n.p,n.m).sort(u.compareZip).slice(r);u.matchTieCompute(e,r,function(n,r){var e=u.resultEntry(t,n);(l>=r||1===r&&!h)&&(e.wins+=1),c&&(e.gpos=r),p[r-h-1].push(e)})});var d=h*s.length+1;p.forEach(function(t){t.forEach(function(t){t.pos=d}),d+=t.length})}),t.sort(m)},d.prototype.rawPositions=function(t){if(!this.isDone())throw new Error("cannot tiebreak a FFA tournament until it is finished");var n=this.sizes.length,r=this.findMatches({r:n}),e=r.map(function(n){var r=i.replicate(n.p.length,[]);return n.p.forEach(function(n){var e=u.resultEntry(t,n);i.insert(r[(e.gpos||e.pos)-1],n)}),r});return e},d.Id=e,n.exports=d},{group:2,interlude:3,tournament:8}],groupstage:[function(t,n,r){function e(t,n,r){return this instanceof e?(this.s=t,this.r=n,void(this.m=r)):new e(t,n,r)}var i=t("interlude"),o=t("tournament"),u=t("roundrobin"),s=t("group");e.prototype.toString=function(){return"G"+this.s+" R"+this.r+" M"+this.m};var a=function(t){return 2*t-1},f=function(t){return 2*t},c=function(t,n,r){for(var i=s(t,n),c=[],h=0;h<i.length;h+=1)for(var l=i[h],p=u(l.length,l),d=0;d<p.length;d+=1)for(var m=p[d],v=0;v<m.length;v+=1){var g=m[v];if(r){var y=g.slice().reverse();c.push({id:new e(h+1,a(d+1),v+1),p:g}),c.push({id:new e(h+1,f(d+1),v+1),p:y})}else c.push({id:new e(h+1,d+1,v+1),p:g})}return c.sort(o.compareMatches)},h=o.sub("GroupStage",function(t,n){var r=c(this.numPlayers,t.groupSize,t.meetTwice);this.numGroups=i.maximum(r.map(i.get("id","s"))),this.groupSize=Math.ceil(this.numPlayers/this.numGroups),this.winPoints=t.winPoints,this.tiePoints=t.tiePoints,this.scoresBreak=t.scoresBreak,n(r)});h.configure({defaults:function(t,n){return n.groupSize=Number(n.groupSize)||t,n.meetTwice=Boolean(n.meetTwice),n.winPoints=Number.isFinite(n.winPoints)?n.winPoints:3,n.tiePoints=Number.isFinite(n.tiePoints)?n.tiePoints:1,n.scoresBreak=Boolean(n.scoresBreak),n},invalid:function(t,n){return 2>t?"numPlayers cannot be less than 2":n.groupSize<2?"groupSize cannot be less than 2":n.groupSize>t?"groupSize cannot be greater than numPlayers":null}}),h.prototype.groupFor=function(t){for(var n=0;n<this.matches.length;n+=1){var r=this.matches[n];if(r.p.indexOf(t)>=0)return r.id.s}},h.prototype._safe=i.constant(!0),h.prototype._initResult=function(t){return{grp:this.groupFor(t),gpos:this.groupSize,pts:0,draws:0,losses:0}},h.prototype._stats=function(t,n){if(!n.m)return t;var r=o.resultEntry(t,n.p[0]),e=o.resultEntry(t,n.p[1]);if(n.m[0]===n.m[1])r.pts+=this.tiePoints,e.pts+=this.tiePoints,r.draws+=1,e.draws+=1;else{var i=n.m[0]>n.m[1]?r:e,u=n.m[0]>n.m[1]?e:r;i.wins+=1,i.pts+=this.winPoints,u.losses+=1}return r["for"]+=n.m[0],e["for"]+=n.m[1],r.against+=n.m[1],e.against+=n.m[0],t};var l=function(t,n){for(var r=i.replicate(n,[]),e=0;e<t.length;e+=1){var o=t[e];r[o.grp-1].push(o)}return r},p=function(t,n,r,e){o.resTieCompute(t,n,e,function(t){var n="PTS"+t.pts;return r&&(n+="DIFF"+(t["for"]-t.against)),n})},d=function(t,n){var r=t["for"]-t.against,e=n["for"]-n.against;return n.pts-t.pts||e-r||t.seed-n.seed},m=function(t,n){return t.pos-n.pos||d(t,n)};h.prototype._sort=function(t){var n=this.scoresBreak;t.sort(d);var r=i.replicate(this.groupSize,[]);if(l(t,this.numGroups).forEach(function(t){p(t,0,n,function(t,n){t.gpos=n,r[n-1].push(t)})}),this.isDone()){var e=1;r.forEach(function(t){t.forEach(function(t){t.pos=e}),e+=t.length})}return t.sort(m)},h.prototype.rawPositions=function(t){return l(t,this.numGroups).map(function(t){for(var n=i.replicate(t.length,[]),r=0;r<t.length;r+=1){var e=t[r];i.insert(n[e.gpos-1],e.seed)}return n})},h.id=e,h.Id=e,n.exports=h},{group:2,interlude:3,roundrobin:5,tournament:8}],tiebreaker:[function(t,n,r){function e(t,n,r,e){this.s=t,this.r=n,this.m=r,Object.defineProperty(this,"_simple",{value:e})}function i(t,n,r,u){if(!(this instanceof i))return new i(t,n,r,u);this._opts=i.defaults(u);var a=i.invalid(t,n,this._opts,r);if(null!==a)throw this._opts.log.error("Invalid %d player TieBreaker with oldRes=%j rejected, opts=%j",r,t,this._opts),new Error("Cannot construct TieBreaker: "+a);var f=l(n,r,this._opts),c=[];if(this._opts.grouped){for(var h=0;h<f.length;h+=1)for(var p=0;p<f[h].matches.length;p+=1){var d=f[h].matches[p];c.push({id:new e(f[h].tbSection,d.id.r,d.id.m),p:d.p.slice()})}this.groupStages=f}else c=f;s.call(this,t.length,c),this.name="TieBreaker",this.grouped=this._opts.grouped,this.strict=this._opts.strict,this.posAry=n,this.limit=r,this.oldRes=t,this.numSections=n.length,this.sectionSize=o.flatten(n[0]).length,this.betweenPosition=Math.ceil(this.limit/this.numSections);var m=this.players();this.numPlayers=m.length;var v=t.filter(function(t){return m.indexOf(t.seed)<0&&t.pos<=r}).length;t.forEach(function(t){m.indexOf(t.seed)>=0&&(t.pos=m.length+v)})}var o=t("interlude"),u=t("groupstage"),s=t("tournament");e.prototype.toString=function(){return this._simple?"S"+this.s+" TB":"S"+this.s+" TB R"+this.r+" M"+this.m};var a=function(t){return new e(t,1,1,!0)},f=function(t,n,r){var e=t.length,i=Math.ceil(n/e);return t.map(function(t){for(var n=i,e=0;n>0;e+=1){var o=t[e],u=o.length>1&&o.length===n&&r;if(o.length>n||u)return o.slice();n-=o.length}return[]})},c=function(t,n,r){var e=new u(t.length,r);return e.tbSection=n,e.matches.forEach(function(n){n.p.forEach(function(r,e){n.p[e]=t[r-1]})}),e},h=function(t,n){return{id:a(n),p:t}},l=function(t,n,r){var e=[];return f(t,n,r.breakForBetween).forEach(function(t,n){if(t.length){var i=r.grouped?c:h;e.push(i(t,n+1,r.groupOpts))}}),e},p=function(t){if(!this.grouped){var n=this.findMatch({s:t,r:1,m:1});return n&&n.m?n:null}var r=o.firstBy(function(n){return n.tbSection===t},this.groupStages);if(null==r||!r.isDone())return null;var e=r.results(),i=r.rawPositions(e),u={p:[],m:[]};return i[0].forEach(function(t,n){t.forEach(function(t){u.p.push(t),u.m.push(i[0].length-n)})}),u},d=function(t,n){var r=o.replicate(t.length,[]);return t.forEach(function(t,e){if(t.indexOf(n.p[0])<0)return void(r[e]=r[e].concat(t));var i=o.zip(n.p,n.m).sort(s.compareZip);s.matchTieCompute(i,0,function(t,n){r[e+n-1].push(t)})}),r};s.inherit(i),i.invalid=function(t,n,r,e){if(!Array.isArray(t))return"results must be implemented";if(!Array.isArray(n)||!n.length)return"rawPositions must be implemented properly";if(!s.isInteger(e)||1>e||e>=t.length)return"limit must be an integer in {1, ..., previous.numPlayers}";if(e%n.length!==0)return"number of sections must divide limit";t.forEach(function(t){return[t.seed,t["for"],t.pos].every(s.isInteger)?void 0:"invalid results format - common properties missing"});var i=n[0].length,u=o.flatten(n[0]).length;return n.forEach(function(t){return t.forEach(function(t){return!s.isInteger(t)||t<=s.NONE?"invalid rawPositions - all entries must be arrays of integers":void 0}),Math.abs(t.length-i)>1?"rawPositions must be ~equally long for every section":Math.abs(o.flatten(t).length-u)>1?"rawPositions must contain ~equally many players per section":void 0}),null},i.defaults=function(t){var n=s.defaults(Math.Infinity,t||{});return n.breakForBetween=Boolean(n.breakForBetween),n.grouped=Boolean(n.grouped),n.groupOpts=n.grouped?u.defaults(Math.Infinity,n.groupOpts):{},delete n.groupOpts.groupSize,delete n.groupOpts.log,n.strict=Boolean(n.strict)&&!n.grouped,n},i.from=function(t,n,r){var e="Cannot forward from "+t.name+": ";if(!t.isDone())throw new Error(e+"tournament not done");var o=t.results();if(o.length<n)throw new Error(e+"not enough players");if(!t.rawPositions)throw new Error(t.name+" does not implement rawPositions");var u=t.rawPositions(o);
return new i(o,u,n,r)},i.isNecessary=function(t,n,r){var e=i.defaults(r),o=t.rawPositions(t.results()),u=function(t){return t.length>0},s=f(o,n,e.breakForBetween);return s.some(u)},i.prototype._verify=function(t,n){return this.strict&&o.nub(n).length!==n.length?"scores must unambiguously decide every position in strict mode":null},i.prototype._safe=o.constant(!0),i.prototype._progress=function(t){if(this.grouped){var n=o.firstBy(function(n){return n.tbSection===t.id.s},this.groupStages),r={s:1,r:t.id.r,m:t.id.m};n.score(r,t.m)}};var m=function(t,n){var r=t["for"]-(t.against||0),e=n["for"]-(n.against||0);return n.pts-t.pts||e-r||t.seed-n.seed},v=function(t,n){return t.pos!==n.pos?t.pos-n.pos:m(t,n)},g=function(t){var n=1;t.forEach(function(t){t.sort(m),t.forEach(function(t){t.pos=n}),n+=t.length})};i.prototype.results=function(){var t=this.oldRes.map(function(t){return o.extend({},t)}),n=o.replicate(this.sectionSize,[]);return this.rawPositions().forEach(function(r){r.forEach(function(r,e){r.forEach(function(r){var i=s.resultEntry(t,r);i.gpos=e+1,n[e].push(i)})})}),this.isDone()&&g(n),t.sort(v)},i.prototype.rawPositions=function(){var t=p.bind(this);return this.posAry.map(function(n,r){var e=t(r+1);return null==e?n:d(n,e)})},i.Id=e,n.exports=i},{groupstage:"groupstage",interlude:3,tournament:8}]},{},[])("tiebreaker")});